# –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤ –≤ –ë–î

## üìã –û–≥–ª—è–¥

–í—Å—ñ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ –∞–∫–∞—É–Ω—Ç–∞ —Ç–µ–ø–µ—Ä –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –±–µ–∑–ø–æ—Å–µ—Ä–µ–¥–Ω—å–æ –≤ –±–∞–∑—ñ –¥–∞–Ω–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∑–∞–º—ñ—Å—Ç—å localStorage. –¶–µ –¥–æ–∑–≤–æ–ª—è—î —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑—É–≤–∞—Ç–∏ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –º—ñ–∂ –ø—Ä–∏—Å—Ç—Ä–æ—è–º–∏ —Ç–∞ –∑–±–µ—Ä—ñ–≥–∞—Ç–∏ –¥–∞–Ω—ñ –Ω–∞ —Å–µ—Ä–≤–µ—Ä—ñ.

## üéØ –©–æ –∑–º—ñ–Ω–∏–ª–æ—Å—å

### –ù–æ–≤—ñ —Ñ–∞–π–ª–∏:
1. **`SUPABASE_USER_PREFERENCES.sql`** - SQL –∑–∞–ø–∏—Ç –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ç–∞–±–ª–∏—Ü—ñ –∑ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è–º–∏
2. **`frontend/src/api/preferences.js`** - API –¥–ª—è —Ä–æ–±–æ—Ç–∏ –∑ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è–º–∏
3. **`USER_PREFERENCES_SETUP.md`** - —Ü–µ–π —Ñ–∞–π–ª –∑ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—î—é

### –û–Ω–æ–≤–ª–µ–Ω—ñ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏:
1. **`EarningsChart.jsx`** - –≥—Ä–∞—Ñ—ñ–∫ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤ —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—ó:
   - –í–∞–ª—é—Ç–∞
   - –†–µ–∂–∏–º (–î–æ—Ö—ñ–¥/–í–∏—Ç—Ä–∞—Ç–∞)
   - –ü–µ—Ä—ñ–æ–¥ —á–∞—Å—É (from/to/appliedFrom/appliedTo)

2. **`CardsManager.jsx`** - —Ñ—ñ–ª—å—Ç—Ä –∫–∞—Ä—Ç–æ–∫ –∑–∞ –±–∞–Ω–∫–∞–º–∏

3. **`TotalsCard.jsx`** - –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –ø–µ—Ä–µ–≥–ª—è–¥—É –±–∞–ª–∞–Ω—Å—É:
   - –ê–∫—Ç–∏–≤–Ω–∞ —Å–µ–∫—Ü—ñ—è (Cash/Cards/Savings)
   - –í–∏–¥–∏–º—ñ—Å—Ç—å

## üóÑÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–∏—Ö

–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –≤ JSON —Ñ–æ—Ä–º–∞—Ç—ñ –≤ —Ç–∞–±–ª–∏—Ü—ñ `user_preferences`:

```json
{
  "chart": {
    "currency": "UAH",
    "mode": "earning",
    "from": "2024-12-01",
    "appliedFrom": "2024-12-01"
  },
  "cards": {
    "selectedBanks": ["MonoBank", "PrivatBank"]
  },
  "totals": {
    "section": 0,
    "isVisible": true
  }
}
```

**–ü—Ä–∏–º—ñ—Ç–∫–∞:** `to` —Ç–∞ `appliedTo` –Ω–µ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –≤ –ë–î, –æ—Å–∫—ñ–ª—å–∫–∏ –≤–æ–Ω–∏ –∑–∞–≤–∂–¥–∏ –≤—Å—Ç–∞–Ω–æ–≤–ª—é—é—Ç—å—Å—è –Ω–∞ —Å—å–æ–≥–æ–¥–Ω—ñ—à–Ω—é –¥–∞—Ç—É.

## üöÄ –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è

### –ö—Ä–æ–∫ 1: –°—Ç–≤–æ—Ä–∏—Ç–∏ —Ç–∞–±–ª–∏—Ü—é –≤ Supabase

1. –í—ñ–¥–∫—Ä–∏–π—Ç–µ Supabase Dashboard
2. –ü–µ—Ä–µ–π–¥—ñ—Ç—å –≤ SQL Editor
3. –í—ñ–¥–∫—Ä–∏–π—Ç–µ —Ñ–∞–π–ª `SUPABASE_USER_PREFERENCES.sql`
4. –°–∫–æ–ø—ñ—é–π—Ç–µ —Ç–∞ –≤–∏–∫–æ–Ω–∞–π—Ç–µ –≤–µ—Å—å SQL –∑–∞–ø–∏—Ç
5. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ, —â–æ —Ç–∞–±–ª–∏—Ü—è —Å—Ç–≤–æ—Ä–µ–Ω–∞ —É—Å–ø—ñ—à–Ω–æ

### –ö—Ä–æ–∫ 2: –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞

–í–∏–∫–æ–Ω–∞–π—Ç–µ –Ω–∞—Å—Ç—É–ø–Ω–∏–π –∑–∞–ø–∏—Ç –≤ SQL Editor —â–æ–± –ø–µ—Ä–µ–∫–æ–Ω–∞—Ç–∏—Å—å, —â–æ –≤—Å–µ –ø—Ä–∞—Ü—é—î:

```sql
-- –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ç–∞–±–ª–∏—Ü—ñ
SELECT column_name, data_type 
FROM information_schema.columns 
WHERE table_name = 'user_preferences';

-- –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –ø–æ–ª—ñ—Ç–∏–∫–∏ RLS
SELECT policyname 
FROM pg_policies 
WHERE tablename = 'user_preferences';
```

## üîí –ë–µ–∑–ø–µ–∫–∞

Row Level Security (RLS) –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ:
- –ö–æ–∂–µ–Ω –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –±–∞—á–∏—Ç—å —Ç—ñ–ª—å–∫–∏ —Å–≤–æ—ó –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è
- –ó–º—ñ–Ω–∏—Ç–∏ –∞–±–æ –≤–∏–¥–∞–ª–∏—Ç–∏ –º–æ–∂–Ω–∞ —Ç—ñ–ª—å–∫–∏ —Å–≤–æ—ó –¥–∞–Ω—ñ
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –≤–∏–¥–∞–ª–µ–Ω–Ω—è –ø—Ä–∏ –≤–∏–¥–∞–ª–µ–Ω–Ω—ñ –∞–∫–∞—É–Ω—Ç–∞ (CASCADE)

## üíæ API Methods

### –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –≤—Å—ñ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è:
```javascript
import { getUserPreferences } from '../api/preferences'
const prefs = await getUserPreferences()
```

### –ó–±–µ—Ä–µ–≥—Ç–∏ —Å–µ–∫—Ü—ñ—é –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω—å:
```javascript
import { updatePreferencesSection } from '../api/preferences'
await updatePreferencesSection('chart', {
  currency: 'UAH',
  mode: 'earning'
})
```

### –û—Ç—Ä–∏–º–∞—Ç–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É —Å–µ–∫—Ü—ñ—é:
```javascript
import { getPreferencesSection } from '../api/preferences'
const chartPrefs = await getPreferencesSection('chart', {})
```

## üì± –ü—Ä–∏–∫–ª–∞–¥ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è

–í—Å—ñ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ:
1. –ó–∞–≤–∞–Ω—Ç–∞–∂—É—é—Ç—å –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –ø—Ä–∏ –º–æ–Ω—Ç—É–≤–∞–Ω–Ω—ñ
2. –ó–±–µ—Ä—ñ–≥–∞—é—Ç—å –∑–º—ñ–Ω–∏ –≤ –ë–î –ø—Ä–∏ –æ–Ω–æ–≤–ª–µ–Ω–Ω—ñ
3. –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å –∑–Ω–∞—á–µ–Ω–Ω—è –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º —è–∫—â–æ –ë–î –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞

–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑—É—é—Ç—å—Å—è –º—ñ–∂:
- –†—ñ–∑–Ω–∏–º–∏ –ø—Ä–∏—Å—Ç—Ä–æ—è–º–∏
- –†—ñ–∑–Ω–∏–º–∏ –±—Ä–∞—É–∑–µ—Ä–∞–º–∏
- –°–µ—Å—ñ—è–º–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞

## üêõ Troubleshooting

### –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –Ω–µ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è
1. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ –Ω–∞ –Ω–∞—è–≤–Ω—ñ—Å—Ç—å –ø–æ–º–∏–ª–æ–∫
2. –ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—å, —â–æ –≤–∏–∫–æ–Ω–∞–ª–∏ SQL –∑–∞–ø–∏—Ç
3. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ, —â–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–∏–π

### –°—Ç–∞—Ä—ñ –¥–∞–Ω—ñ –≤ localStorage
localStorage –±—ñ–ª—å—à–µ –Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω–∏—Ö –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω—å, –∞–ª–µ –∑–∞–ª–∏—à–∞—î—Ç—å—Å—è –¥–ª—è —Ç–µ—Ö–Ω—ñ—á–Ω–∏—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, `hasTxCurrency`).

### –í—ñ–¥–∫–∞—Ç –∑–º—ñ–Ω
–Ø–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ –ø–æ–≤–µ—Ä–Ω—É—Ç–∏—Å—å –¥–æ localStorage, –≤–∏–¥–∞–ª—ñ—Ç—å —ñ–º–ø–æ—Ä—Ç–∏ `preferences.js` –∑ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ñ–≤ —Ç–∞ –≤—ñ–¥–Ω–æ–≤—ñ—Ç—å –ª–æ–≥—ñ–∫—É –∑ localStorage.

## üìù –ù–æ—Ç–∞—Ç–∫–∏

- –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è —Ç—ñ–ª—å–∫–∏ –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤
- –ü—Ä–∏ –ø–µ—Ä—à–æ–º—É –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å—Å—è –∑–Ω–∞—á–µ–Ω–Ω—è –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º
- –ó–º—ñ–Ω–∏ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —á–µ—Ä–µ–∑ debounce
- –ü–æ–º–∏–ª–∫–∏ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –Ω–µ –±–ª–æ–∫—É—é—Ç—å —Ä–æ–±–æ—Ç—É UI

## ‚úÖ –ü–µ—Ä–µ–≤–∞–≥–∏ –Ω–æ–≤–æ–≥–æ –ø—ñ–¥—Ö–æ–¥—É

1. ‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è –º—ñ–∂ –ø—Ä–∏—Å—Ç—Ä–æ—è–º–∏
2. ‚úÖ –ë–µ–∑–ø–µ–∫–∞ (RLS –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ)
3. ‚úÖ –ù–∞–¥—ñ–π–Ω—ñ—Å—Ç—å (–¥–∞–Ω—ñ –Ω–∞ —Å–µ—Ä–≤–µ—Ä—ñ)
4. ‚úÖ –ú–∞—Å—à—Ç–∞–±–æ–≤–∞–Ω—ñ—Å—Ç—å (–ª–µ–≥–∫–æ –¥–æ–¥–∞—Ç–∏ –Ω–æ–≤—ñ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏)
5. ‚úÖ –Ü—Å—Ç–æ—Ä—ñ—è –∑–º—ñ–Ω —á–µ—Ä–µ–∑ `updated_at` timestamp

## üéâ –ì–æ—Ç–æ–≤–æ!

–¢–µ–ø–µ—Ä –≤—Å—ñ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ –∞–∫–∞—É–Ω—Ç–∞ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –≤ –ë–î. –ó–º—ñ–Ω—ñ—Ç—å –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –≤ –æ–¥–Ω–æ–º—É –º—ñ—Å—Ü—ñ, —ñ –≤–æ–Ω–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑'—è–≤–ª—è—Ç—å—Å—è –≤ —ñ–Ω—à–∏—Ö.

